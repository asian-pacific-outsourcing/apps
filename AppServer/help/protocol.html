<HTML>
<HEAD>
  <META NAME="AUTHOR" CONTENT="Shane Bow">
  <TITLE>Network Message Protocol</TITLE>
</HEAD>
<BODY>

<H1>Network Message Protocol</H1>
<A HREF="toc.html"><IMG SRC="back.gif" WIDTH="42" HEIGHT="22" ALIGN="RIGHT" NATURALSIZEFLAG="3" BORDER="0">Contents</A>
<P>&nbsp;</P>

<H2>Overview</H2>
<P>The client programs all communicate with the Application Server
 following a specific protocol.
A message consists of lading enveloped by a header and
 tail. The header and tail are fixed length, while the lading is
 of arbitry length. A message may carry a request from the client
 to be processed by the server, or a response from the server to
 client. A third message type is a command issued from the server
 to the client. 
 An request message sent from a client to the server is always
 followed by a response message from the server back to the client.
 Requests and responses share the same message structure. However,
 in a request message, the code field indicates the desired operation
 (<I>Op Code</I>), whereas in a response message the code is an
 <I>error code</I>.</P>
<P>The server's <I>Request</I> class reads an inbound (request)
   message to the server. The header information is parsed and the
   data is stored in a buffer for subsequent procesing.</P>

<P>The client applications all share common code located in the
   <I>Client</I> to send messages to the server. Before sending
   each request, <I>Client</I> calculates and prepends the header
   to the request message.</P>

<H2>Message Encoding</H2>
 <P><CENTER><IMG SRC="MessageStructure.gif" BORDER="0"></CENTER></P>
 <P>A message consists of a fixed (12 byte) header prepended to variable
 length message data.</P>

 <TABLE width="90%" border="1" cellspacing="0" cellpadding="1"  align="center"
		  class="main" summary="Contact Dispositions">
	<THEAD ALIGN="center" VALIGN="bottom" ><TR>
		<TD WIDTH="10%">Offset</TD>
				<TD WIDTH="10%">Bytes</TD>
				<TD WIDTH="15%">Encoding</TD>
					<TD WIDTH="*" ALIGN="left">Description</TD></TR></THEAD>
	<TBODY VALIGN="top">
		<TR ALIGN="center"><TD> 0</TD> <TD>1</TD> <TD>byte</TD>
                                <TD ALIGN="left">Version</TD></TR>
		<TR ALIGN="center"><TD> 1</TD> <TD>1</TD> <TD>byte</TD>
                                <TD ALIGN="left">Operation code if this is a request;
                                           or Error Code if this is a reply</TD></TR>
		<TR ALIGN="center"><TD> 2</TD> <TD>2</TD> <TD>short</TD>
                                <TD ALIGN="left">User ID</TD></TR>
		<TR ALIGN="center"><TD> 4</TD> <TD>4</TD> <TD>int</TD>
                                <TD ALIGN="left">Sequence number</TD></TR>
		<TR ALIGN="center"><TD>8</TD> <TD>2</TD> <TD>short</TD>
                                <TD ALIGN="left">Check sum</TD></TR>
		<TR ALIGN="center"><TD>10</TD> <TD>2</TD> <TD>short</TD>
                                <TD ALIGN="left">Byte count of the data that follows</TD></TR>
		<TR ALIGN="center"><TD>12</TD> <TD>?</TD> <TD>ascii byte[] </TD>
                                <TD ALIGN="left">the actual data</TD></TR>
		<TR ALIGN="center"><TD> ?</TD> <TD>1</TD> <TD>byte</TD>
                                <TD ALIGN="left">End of Transmission Byte</TD></TR>
	</TBODY>
 </TABLE>

<H3>Notes</H3>
 <UL>
  <LI><B><I>Version</I></B> must be <B>1</B> or the message will be rejected.</LI>
  <LI><B><I>User ID</I></B> must equal the id returned from in login message.
      The login message expects a user id of 0.</LI>
  <LI><B><I>Sequence Number</I></B> may be considered to be a message id number
      generated by the client then simply echoed back by the server in her response,
      with one exception:
      The reply to the login message returns the last valid sequence number received
      for this client since the last server reset. Thus, a subsequent login may
      continue the existing sequence.</LI>
  <LI><B><I>Check sum</I></B> is applied only to the variable length data, <I>not</I>
      the header (we rely on TCP for that!). It is simply the least significant 15
      bits of the hashcode of the data as a String.</LI>
 </UL>

<P><A HREF="toc.html"><IMG SRC="back.gif" WIDTH="42" HEIGHT="22" ALIGN="BOTTOM" NATURALSIZEFLAG="3" BORDER="0">Contents</A>
</BODY>
</HTML>
